<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Leopard Lab â€” Start</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Helvetica Neue",
        Arial, sans-serif;
      background: #fff;
      color: #111;
      height: 100vh;
      overflow: hidden;
    }

    .page {
      position: relative;
      width: 100%;
      height: 100%;
    }

    /* ì˜¤ë¥¸ìª½ ìƒë‹¨ About / Moments */
    .top-nav {
      position: absolute;
      right: 40px;
      top: 30px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 3;
    }

    .pill-btn {
      padding: 6px 18px;
      border-radius: 999px;
      border: 1px solid #111;
      background: #fff;
      font-size: 12px;
      cursor: pointer;
      transition: 0.2s ease;
    }

    .pill-btn:hover {
      background: #111;
      color: #fff;
    }

    /* íŒ¨í„´ íƒ€ì¼ ê·¸ë¦¬ë“œ (ì „ì²´ í™”ë©´) */
    .archive-layer {
      position: absolute;
      inset: 0;
      display: grid;
      /* cols/rowsëŠ” JSì—ì„œ ë™ì ìœ¼ë¡œ ë³€ê²½ */
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      grid-auto-rows: 120px;
      gap: 0;
      z-index: 1;
    }

    .archive-tile {
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      will-change: background-image;
    }

    /* ê°€ìš´ë° ë¡œê³  + ë²„íŠ¼ */
    .hero {
      position: absolute;
      inset: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2;
      pointer-events: none;
    }

    .hero-inner {
      pointer-events: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 40px;
    }

    .logo-img {
      width: 560px;
      max-width: 95vw;
      height: auto;
      transition: filter 0.25s ease;
    }

    .logo-img:hover {
      filter: invert(1);
    }

    .enter-btn {
      padding: 8px 40px;
      border-radius: 999px;
      background: #000;
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      text-decoration: none;
      letter-spacing: 0.07em;
      cursor: pointer;
      transition: 0.2s ease;
      box-shadow: 0 10px 25px rgba(0,0,0,0.18);
    }

    .enter-btn:hover {
      transform: translateY(-3px) scale(1.03);
      background: #111;
      box-shadow: 0 8px 35px rgba(0,0,0,0.24);
    }

    @media (max-width: 768px) {
      .archive-layer {
        grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
        grid-auto-rows: 90px;
      }
      .logo-img {
        width: 420px;
      }

      .top-nav {
        right: 20px;
        top: 20px;
      }
    }
  </style>
</head>

<body>
  <div class="page">

    <!-- ì˜¤ë¥¸ìª½ ìƒë‹¨ -->
    <div class="top-nav">
      <button class="pill-btn" onclick="window.location.href='about.html'">
        About
      </button>
      <button class="pill-btn"
              onclick="window.location.href='generator.html#archive'">
        Moments
      </button>
    </div>

    <!-- íŒ¨í„´ íƒ€ì¼ ë ˆì´ì–´ -->
    <div class="archive-layer" id="archiveLayer"></div>

    <!-- logo + enter -->
    <main class="hero">
      <div class="hero-inner">
        <img src="leopard-logo.svg" class="logo-img" alt="LEOPARD" />
        <a href="generator.html" class="enter-btn">Enter LAB</a>
      </div>
    </main>

  </div>

  <!-- Firestore + íŒ¨í„´ ê·¸ë¦¬ë“œ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  // ğŸ”¹ ëœë¤ ë°°ì¹˜ì— ì‚¬ìš©í•  ë°°ê²½ ì´ë¯¸ì§€ë“¤ (ê²½ë¡œëŠ” í”„ë¡œì íŠ¸ì— ë§ê²Œ ìˆ˜ì •)
  const BG_IMAGES = [
    "bg1.png",
    "bg2.png",
    "bg3.png",
    "bg4.png"
  ];

  // ë°˜ì‘í˜• & íƒ€ì¼ í¬ê¸° ë²”ìœ„
  const MOBILE_BREAKPOINT = 768;

  // ë°ìŠ¤í¬íƒ‘/ëª¨ë°”ì¼ ê°ê° ìµœì†ŒÂ·ìµœëŒ€ íƒ€ì¼ ê°€ë¡œí­
  const DESKTOP_TILE_MIN = 260;   // ê°€ì¥ ì´˜ì´˜í•  ë•Œ
  const DESKTOP_TILE_MAX = 800;   // ê°€ì¥ í´ ë•Œ (ê¸°ë³¸ ìµœëŒ€)
  const MOBILE_TILE_MIN  = 200;
  const MOBILE_TILE_MAX  = 520;

  // "ì ì " ì»¤ì¡Œë‹¤/ì‘ì•„ì¡Œë‹¤ í•˜ëŠ” ì• ë‹ˆë©”ì´ì…˜ ì£¼ê¸° (ëŠë¦¬ê²Œ)
  const CYCLE_MS      = 12000;          // 12ì´ˆì— 1 ì‚¬ì´í´
  const PHASE_STEPS   = 12;             // 24ë‹¨ê³„ë¡œ ë¶€ë“œëŸ½ê²Œ
  const STEP_INTERVAL = CYCLE_MS / PHASE_STEPS;

  let archiveLayer = null;
  let bgMeta = [];        // { url, ratio }
  let tileEls = [];       // ë§Œë“¤ì–´ì§„ íƒ€ì¼ DOM ë¦¬ìŠ¤íŠ¸
  let resizeTimer = null;
  let phaseTimer = null;
  let phaseIndex = 0;     // 0 ~ PHASE_STEPS-1

  // --------------------------------------------------
  // í˜„ì¬ í™”ë©´ì´ ëª¨ë°”ì¼ì¸ì§€ íŒë‹¨
  // --------------------------------------------------
  function isMobile() {
    return window.innerWidth <= MOBILE_BREAKPOINT;
  }

  // --------------------------------------------------
  // í˜„ì¬ ë‹¨ê³„(phase)ì— ë”°ë¥¸ 0~1 ì›¨ì´ë¸Œ ê°’
  //  - 0ê³¼ 1ì—ì„œ í¬ê³ , ì¤‘ê°„ì—ì„œ ê°€ì¥ ì‘ê²Œ (cos íŒŒí˜•)
  // --------------------------------------------------
  function getPhaseFactor(idx) {
    const t = idx / (PHASE_STEPS - 1);              // 0 â†’ 1
    const wave = 0.5 - 0.5 * Math.cos(t * 2 * Math.PI); // 0 â†’ 1 â†’ 0
    return wave; // 0ì´ë©´ MAX, 1ì´ë©´ MIN ìª½
  }

  // --------------------------------------------------
  // í˜„ì¬ phaseì—ì„œ ì‚¬ìš©í•  íƒ€ì¼ ê°€ë¡œí­ ê³„ì‚°
  //  - phase 0ë§ˆë‹¤ í•­ìƒ ë” í¬ê²Œ ì‹œì‘ (ì˜µì…˜ A)
  // --------------------------------------------------
  function getTileWidthForPhase(idx) {
    // ğŸ”¥ ë§¤ ì‚¬ì´í´ ì‹œì‘(phase 0)ë§ˆë‹¤ ê¸°ë³¸ ìµœëŒ€ë³´ë‹¤ ë” í¬ê²Œ
    if (idx === 0) {
      const extra = isMobile() ? 200 : 350; // ëª¨ë°”ì¼/ë°ìŠ¤í¬íƒ‘ì—ì„œ ì–¼ë§ˆë‚˜ ë” í‚¤ìš¸ì§€
      const baseMax = isMobile() ? MOBILE_TILE_MAX : DESKTOP_TILE_MAX;
      return baseMax + extra;
    }

    const wave = getPhaseFactor(idx);
    const minW = isMobile() ? MOBILE_TILE_MIN  : DESKTOP_TILE_MIN;
    const maxW = isMobile() ? MOBILE_TILE_MAX  : DESKTOP_TILE_MAX;

    // wave = 0 â†’ maxW, wave = 1 â†’ minW
    return Math.round(maxW - wave * (maxW - minW));
  }

  // --------------------------------------------------
  // í”Œë¦½(ì¢Œìš°/ìƒí•˜/ëŒ€ê°/ë¬´í”Œë¦½) ëœë¤ ì ìš©
  // --------------------------------------------------
  function applyRandomFlip(tile) {
    const r = Math.random();
    let t = "none";

    if (r < 0.25) {
      t = "scaleX(-1)";        // ì¢Œìš° ë°˜ì „
    } else if (r < 0.5) {
      t = "scaleY(-1)";        // ìƒí•˜ ë°˜ì „
    } else if (r < 0.75) {
      t = "scale(-1, -1)";     // ì¢Œìš°+ìƒí•˜
    } else {
      t = "none";              // ê·¸ëŒ€ë¡œ
    }

    tile.style.transform = t;
    tile.style.transformOrigin = "center center";
  }

  // --------------------------------------------------
  // íŠ¹ì • phase ê¸°ì¤€ìœ¼ë¡œ ê·¸ë¦¬ë“œ ìƒì„±
  //  - íƒ€ì¼ í¬ê¸°(=ê°œìˆ˜)ê°€ ì»¤ì¡Œë‹¤/ì‘ì•„ì¡Œë‹¤
  //  - bg1~4 + í”Œë¦½ ëœë¤
  // --------------------------------------------------
  function buildGridForPhase(idx) {
    if (!archiveLayer || !bgMeta.length) return;

    const vw = window.innerWidth;
    const vh = window.innerHeight;

    const tileWidth  = getTileWidthForPhase(idx);
    const baseRatio  = bgMeta[0].ratio || (9 / 16);  // ëª» ì½ìœ¼ë©´ 16:9 ê°€ì •
    const tileHeight = Math.round(tileWidth * baseRatio);

    // í™”ë©´ì„ ë®ê¸° ìœ„í•´ í•„ìš”í•œ ì—´/í–‰ ìˆ˜ ê³„ì‚°
    const cols  = Math.ceil(vw / tileWidth) + 1;
    const rows  = Math.ceil(vh / tileHeight) + 1;
    const total = cols * rows;

    archiveLayer.innerHTML = "";
    tileEls = new Array(total);

    archiveLayer.style.display = "grid";
    archiveLayer.style.gridTemplateColumns = `repeat(${cols}, ${tileWidth}px)`;
    archiveLayer.style.gridAutoRows       = `${tileHeight}px`;

    for (let i = 0; i < total; i++) {
      const meta = bgMeta[Math.floor(Math.random() * bgMeta.length)];

      const tile = document.createElement("div");
      tile.className = "archive-tile";

      tile.style.width  = tileWidth + "px";
      tile.style.height = tileHeight + "px";

      tile.style.backgroundImage    = `url(${meta.url})`;
      tile.style.backgroundRepeat   = "repeat";
      tile.style.backgroundSize     = "cover";
      tile.style.backgroundPosition = "center";

      // ğŸ”¥ í”Œë¦½ ëœë¤ ì ìš©
      applyRandomFlip(tile);

      tileEls[i] = tile;
      archiveLayer.appendChild(tile);
    }
  }

  // --------------------------------------------------
  // ì£¼ê¸°ì ìœ¼ë¡œ phaseë¥¼ ì¦ê°€ì‹œí‚¤ë©´ì„œ
  //  íƒ€ì¼ í¬ê¸°/ê°œìˆ˜ + ì´ë¯¸ì§€/í”Œë¦½ì„ í•¨ê»˜ ê°±ì‹ 
  //  (ë§¤ ì‚¬ì´í´ ì‹œì‘ = í° íƒ€ì¼ ê·¸ë¦¬ë“œ)
  // --------------------------------------------------
  function advancePhase() {
    phaseIndex = (phaseIndex + 1) % PHASE_STEPS;
    buildGridForPhase(phaseIndex);
  }

  // --------------------------------------------------
  // ì´ë¯¸ì§€ í”„ë¦¬ë¡œë“œ + ë¹„ìœ¨ ì¶”ì¶œ
  // --------------------------------------------------
  function preloadAndInit() {
    if (!BG_IMAGES.length) return;

    let loaded = 0;

    BG_IMAGES.forEach((url) => {
      const img = new Image();

      img.onload = function () {
        const ratio =
          img.naturalWidth && img.naturalHeight
            ? img.naturalHeight / img.naturalWidth
            : 9 / 16;

        bgMeta.push({ url, ratio });
        loaded++;

        // ëª¨ë“  ì´ë¯¸ì§€ ë¡œë”© ì™„ë£Œ í›„ ê·¸ë¦¬ë“œ + ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
        if (loaded === BG_IMAGES.length && bgMeta.length) {
          phaseIndex = 0;
          buildGridForPhase(phaseIndex);

          if (!phaseTimer) {
            phaseTimer = setInterval(advancePhase, STEP_INTERVAL);
          }
        }
      };

      img.onerror = function () {
        loaded++;
        if (loaded === BG_IMAGES.length && bgMeta.length) {
          phaseIndex = 0;
          buildGridForPhase(phaseIndex);

          if (!phaseTimer) {
            phaseTimer = setInterval(advancePhase, STEP_INTERVAL);
          }
        }
      };

      img.src = url;
    });
  }

  // --------------------------------------------------
  // ì´ˆê¸° ì‹¤í–‰
  // --------------------------------------------------
  window.addEventListener("load", function () {
    archiveLayer = document.getElementById("archiveLayer");
    if (!archiveLayer) return;

    preloadAndInit();

    // ë¦¬ì‚¬ì´ì¦ˆ ì‹œ, í˜„ì¬ phaseë¥¼ ìœ ì§€í•œ ì±„ ë‹¤ì‹œ ê·¸ë¦¬ê¸° (ë””ë°”ìš´ìŠ¤)
    window.addEventListener("resize", function () {
      if (resizeTimer) clearTimeout(resizeTimer);
      resizeTimer = setTimeout(function () {
        buildGridForPhase(phaseIndex);
      }, 180);
    });
  });
</script>
